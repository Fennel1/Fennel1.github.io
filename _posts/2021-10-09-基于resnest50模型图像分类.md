---
layout:     post
title:      基于resnest50模型的图像分类baseline
subtitle:   kaggle竞赛 Classify Leaves
date:       2021-10-09
author:     fennel
header-img: img/post-bg-recitewords.jpg
catalog: false
tags:
    - 深度学习
---

深度学习是在b站跟着李沐老师学的,选的kaggle竞赛也是[动手学深度学习](https://zh-v2.d2l.ai/index.html)里的.
- [李沐老师b站主页](https://space.bilibili.com/1567748478/?spm_id_from=333.999.0.0)
- [kaggle竞赛(Classify Leaves)](https://www.kaggle.com/c/classify-leaves)

因为大二要跟老师做大创,所以做些kaggle竞赛来检验一下学习成果.
同时也是记录一下图像分类的方法方便以后再使用,代码是[NEKO KIKU的simple resnet baseline](https://www.kaggle.com/nekokiku/simple-resnet-baseline).
自己完全理解后写的本文.

## 关于数据

| 训练样本数 | 预测样本数 | 类别数 | 图片尺寸 |
| :---: | :---: | :---: | :----: |
| 18353 | 8800 | 176 | 224*224 |

![数据图片1](/my_img/1.jpg)![数据图片2](/my_img/7.jpg)![数据图片3](/my_img/123.jpg)

## 创建自己的Dataset
```python
class MyDataset(Dataset):
    def __init__(self, csv_path, file_path, mode='train', valid_ratio=0.2, resize_height=64, resize_width=64):
        """
        Args:
            csv_path (string): csv 文件路径
            img_path (string): 图像文件所在路径
            mode (string): 训练模式还是测试模式
            valid_ratio (float): 验证集比例
        """
        
        self.resize_height = resize_height
        self.resize_width = resize_width
        
        self.file_path = file_path
        self.mode = mode
        
        self.data_info = pd.read_csv(csv.path, header=None)
        self.data_len = len(self.data_info.index) - 1
        self.train_len = int(self.data_len * (1 - valid_ratio))
        
        if mode == 'train':
            self.train_image = np.asarray(self.data_info.iloc[1:self.train_len, 0])
            self.train_label = np.asarray(self.data_info.iloc[1:self.train_len, 1])
            self.image_arr = self.train_image
            self.label_arr = self.train_label
        elif mode == 'valid':
            self.test_image = np.asarray(self.data_info.iloc[self.train_len:, 0])
            self.test_label = np.asarray(self.data_info.iloc[self.train_len:, 1])
            self.image_arr = self.train_image
            self.label_arr = self.train_label
        elif mode == 'test':
            self.test_image = np.asarray(self.data_info.iloc[1:, 0])
            self.image_arr = self.test_image
            
        self.len = len(self.image_arr)
        
        print('{}数据集,{}个样本'.format(mode, self.len))
        
    def __getitem__(self, index):
        
        image_name = self.image_arr[index]
        img = Image.open(self.file_path + image_name)
        
        if self.mode == 'train':
            transform = transforms.Compose([
                transforms.RandomResizedCrop(64, scale=(0.08, 1.0), ratio=(3.0 / 4.0, 4.0 / 3.0)),
                transforms.RandomHorizontalFlip(),
                transforms.ColorJitter(brightness=0.4, contrast=0.4, saturation=0.4),
                transforms.ToTensor(),
            ])
        else:
            transform = transforms.Compose([
                transforms.ToTensor(),
                transforms.Normalize([0.485, 0.456, 0.406], [0.229, 0.224, 0.225])
            ])
            
        img = transform(img)
        
        if self.mode == 'test':
            return img
        else:
            num_labels = class_to_num[self.label_arr[index]]
            return img, num_labels
        
    def __len__(self):
        return self.len
```

## 模型使用

## 训练/测试/预测
